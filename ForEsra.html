<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle Çözücü (Web)</title>
    <style>
        /* --- CSS KODLARI BURAYA --- */
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
            background-color: #f4f4f4;
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px; /* Maksimum genişlik */
        }

        h1, h2 {
            text-align: center;
            color: #333;
        }

        #initial-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #initial-screen label {
            margin-bottom: 10px;
        }
        #initial-screen .radio-group label {
            margin-right: 10px;
        }
        #initial-screen button {
            margin-top: 15px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #initial-screen #file-input-label {
            display: block;
            margin-top: 20px;
            margin-bottom: 5px;
            font-weight: bold;
        }
        #wordlist-file {
            margin-bottom: 10px;
        }

        #solver-screen {
            display: none;
            flex-direction: column;
            align-items: center;
        }

        .input-area, .controls, .suggestions, .status {
            margin-bottom: 15px;
            width: 100%;
        }

        .input-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            justify-content: center;
        }
        .input-row label {
            margin-right: 10px;
            min-width: 60px;
        }

        #guess-input {
            padding: 8px;
            font-size: 1.2em;
            text-align: center;
            text-transform: uppercase;
            border: 1px solid #ccc;
            border-radius: 4px;
            letter-spacing: 2px;
        }

        #result-squares {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .result-square {
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            border-radius: 4px;
            transition: background-color 0.2s, color 0.2s;
        }

        .result-square.gray { background-color: #787c7e; color: white; }
        .result-square.yellow { background-color: #c9b458; color: white; }
        .result-square.green { background-color: #6aaa64; color: white; }

        .controls button {
            padding: 10px 15px;
            margin: 5px;
            font-size: 1em;
            cursor: pointer;
            border: 1px solid #ddd;
            background-color: #e7e7e7;
            border-radius: 4px;
        }
        .controls button:hover {
            background-color: #d7d7d7;
        }
        .controls button:disabled {
            background-color: #f0f0f0;
            color: #aaa;
            cursor: not-allowed;
        }

        #suggestions-list {
            list-style: none;
            padding: 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        #suggestions-list li {
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            text-transform: uppercase;
        }
        #suggestions-list li:last-child {
            border-bottom: none;
        }
        #suggestions-list li:hover {
            background-color: #f9f9f9;
        }

        #status-message {
            text-align: center;
            color: navy;
            font-style: italic;
            min-height: 1.2em;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Türkçe Wordle Çözücü</h1>

        <div id="initial-screen">
            <label id="file-input-label" for="wordlist-file">1. Kelime Listesi Yükle (.txt):</label>
            <input type="file" id="wordlist-file" accept=".txt">
            <h2>2. Kelime Uzunluğunu Seçin</h2>
            <div class="radio-group">
                <label><input type="radio" name="wordLength" value="5" checked> 5</label>
                <label><input type="radio" name="wordLength" value="6"> 6</label>
                <label><input type="radio" name="wordLength" value="7"> 7</label>
                <label><input type="radio" name="wordLength" value="8"> 8</label>
            </div>
            <button id="start-game-btn">3. Oyuna Başla</button>
        </div>

        <div id="solver-screen">
            <h2 id="solver-title">X Harfli Çözücü</h2>
            <div class="input-area">
                <div class="input-row">
                    <label for="guess-input">Tahmin:</label>
                    <input type="text" id="guess-input" maxlength="5">
                </div>
                <div class="input-row">
                    <label>Sonuç:</label>
                    <div id="result-squares"></div>
                </div>
            </div>
            <div class="controls">
                <button id="filter-btn">Filtrele ve Öner</button>
                <button id="reset-btn">Sıfırla</button>
                <button id="new-game-btn">Yeni Oyun (Uzunluk Seç)</button>
            </div>
            <div class="suggestions">
                <h3>Öneriler:</h3>
                <ul id="suggestions-list"></ul>
            </div>
            <div class="status">
                <p id="status-message">Kelime uzunluğunu seçerek başlayın.</p>
            </div>
        </div>
    </div>

    <script>
        const SUGGESTION_COUNT = 5;
        const VALID_LENGTHS = [5, 6, 7, 8];
        let currentWordLength = 5;
        let masterWordList = [];
        let allWordsCurrentLength = [];
        let possibleWords = [];
        let isFirstGuess = true;
        let bestStarters = [];

        const LETTER_FREQUENCIES = {
            5: Array.from(turkishLower("AEIKRLMTNS")),
            6: Array.from(turkishLower("AEIKLRTMNİ")),
            7: Array.from(turkishLower("AEILKMRİTN")),
            8: Array.from(turkishLower("AEKLİMRTİN"))
        };
        const TOP_LETTERS_BY_LENGTH = {};
        for (const len in LETTER_FREQUENCIES) {
            TOP_LETTERS_BY_LENGTH[len] = new Set(LETTER_FREQUENCIES[len]);
        }

        const colorCycle = ['gray', 'yellow', 'green'];
        const colorMapToChar = {'gray': 'G', 'yellow': 'S', 'green': 'Y'};

        const initialScreen = document.getElementById('initial-screen');
        const solverScreen = document.getElementById('solver-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const wordlistFileEl = document.getElementById('wordlist-file');
        const solverTitle = document.getElementById('solver-title');
        const guessInput = document.getElementById('guess-input');
        const resultSquaresContainer = document.getElementById('result-squares');
        const filterBtn = document.getElementById('filter-btn');
        const resetBtn = document.getElementById('reset-btn');
        const newGameBtn = document.getElementById('new-game-btn');
        const suggestionsList = document.getElementById('suggestions-list');
        const statusMessage = document.getElementById('status-message');

        function turkishLower(s) {
            if (!s) return "";
            return s.replace(/İ/g, 'i').replace(/I/g, 'ı').toLowerCase();
        }

        async function loadWordsFromFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const text = event.target.result;
                    const words = text.split(/\r?\n/)
                                      .map(word => turkishLower(word.trim()))
                                      .filter(word => {
                                          const len = word.length;
                                          const isValidChar = /^[a-zçğıöşü]+$/i.test(word.replace(/[ıi]/g, 'i'));
                                          const isValidLength = len >= Math.min(...VALID_LENGTHS) && len <= Math.max(...VALID_LENGTHS);
                                          return isValidChar && isValidLength;
                                      });
                    console.log(`Dosyadan okunan ${words.length} kelime işlendi.`);
                    resolve(words);
                };
                reader.onerror = (event) => {
                    console.error("FileReader Error:", event.target.error);
                    reject(new Error("Dosya okunurken hata: " + event.target.error.name));
                };
                reader.readAsText(file, "UTF-8");
            });
        }

        function validateInput(guess, resultString, wordLength) {
            const guessLower = turkishLower(guess);
            if (guess.length !== wordLength) { return { isValid: false, message: `Tahmin tam olarak ${wordLength} harf olmalıdır.` }; }
            if (!/^[a-zçğıöşü]+$/i.test(guessLower.replace(/[ıi]/g, 'i'))) { return { isValid: false, message: "Tahmin sadece geçerli harf içermelidir." };}
            if (resultString.length !== wordLength) { return { isValid: false, message: `Sonuç ${wordLength} karakterli olmalı.` }; }
            return { isValid: true, message: "" };
        }

        function filterWords(possible, guess, resultColors, wordLength) {
            const guessLower = turkishLower(guess);
            const newPossibleWords = [];
            const minCounts = {};
            const exactCounts = {};
            for (let i = 0; i < wordLength; i++) {
                const letter = guessLower[i]; const color = resultColors[i];
                if (color === 'green' || color === 'yellow') { minCounts[letter] = (minCounts[letter] || 0) + 1; }
            }
            for (let i = 0; i < wordLength; i++) {
                const letter = guessLower[i]; const color = resultColors[i];
                if (color === 'gray') {
                    if (!minCounts[letter]) { exactCounts[letter] = 0; }
                    else { exactCounts[letter] = minCounts[letter]; }
                }
            }
            for (const word of possible) {
                const currentWordLower = turkishLower(word); let isValid = true;
                const currentWordCounts = {};
                for(const char of currentWordLower) { currentWordCounts[char] = (currentWordCounts[char] || 0) + 1; }
                for (let i = 0; i < wordLength; i++) { if (resultColors[i] === 'green' && currentWordLower[i] !== guessLower[i]) { isValid = false; break; } }
                if (!isValid) continue;
                for (let i = 0; i < wordLength; i++) { if (resultColors[i] === 'yellow') { if (!currentWordLower.includes(guessLower[i]) || currentWordLower[i] === guessLower[i]) { isValid = false; break; } } }
                if (!isValid) continue;
                for (const letter in minCounts) { if ((currentWordCounts[letter] || 0) < minCounts[letter]) { isValid = false; break; } }
                if (!isValid) continue;
                for (const letter in exactCounts) { if ((currentWordCounts[letter] || 0) !== exactCounts[letter]) { isValid = false; break; } }
                if (!isValid) continue;
                for (let i = 0; i < wordLength; i++) { if (resultColors[i] === 'gray' && currentWordLower[i] === guessLower[i]) { isValid = false; break; } }
                if (!isValid) continue;
                if (isValid) { newPossibleWords.push(word); }
            }
            return newPossibleWords;
        }

        function calculateStartScore(word, topLettersSet, wordLength) {
            const wordLower = turkishLower(word); const wordSet = new Set(wordLower.split(''));
            let uniqueLetterBonus = (wordSet.size === wordLength) ? 150 : wordSet.size * Math.floor(150 / wordLength);
            let frequencyScore = 0; let allTopBonus = 0; let topLettersInWordCount = 0;
            wordSet.forEach(letter => { if (topLettersSet.has(letter)) { topLettersInWordCount++; } });
            frequencyScore = topLettersInWordCount * 25;
            if (Array.from(wordSet).every(letter => topLettersSet.has(letter))) { allTopBonus = 15; }
            return uniqueLetterBonus + frequencyScore + allTopBonus;
        }

        function findBestStartingWords(words, topLettersSet, count, wordLength) {
            if (!words || words.length === 0) return [];
            const scoredWordsData = words.map(word => ({ // Değişken adını değiştirdim
                word: word,
                score: calculateStartScore(word, topLettersSet, wordLength)
            }));
            scoredWordsData.sort((a, b) => b.score - a.score || a.word.localeCompare(b.word, 'tr'));
            // *** DÜZELTİLMİŞ SATIR ***
            return scoredWordsData.slice(0, count).map(item => item.word);
        }

        function createResultSquares(length) {
            resultSquaresContainer.innerHTML = '';
            for (let i = 0; i < length; i++) {
                const square = document.createElement('div');
                square.classList.add('result-square', 'gray');
                square.dataset.index = i; square.textContent = '?'; square.dataset.color = 'gray';
                square.addEventListener('click', () => {
                    const currentColor = square.dataset.color;
                    const currentIndex = colorCycle.indexOf(currentColor);
                    const nextColor = colorCycle[(currentIndex + 1) % colorCycle.length];
                    square.className = 'result-square ' + nextColor; square.dataset.color = nextColor;
                });
                resultSquaresContainer.appendChild(square);
            }
        }
        function updateResultLabelTexts(guessStr) {
            const squares = resultSquaresContainer.children;
            for (let i = 0; i < currentWordLength; i++) { if (squares[i]) { squares[i].textContent = (i < guessStr.length) ? guessStr[i].toUpperCase() : '?'; } }
        }
        function resetResultSquares() {
            const squares = resultSquaresContainer.children;
            for (let i = 0; i < currentWordLength; i++) { if (squares[i]) { squares[i].className = 'result-square gray'; squares[i].dataset.color = 'gray'; } }
            updateResultLabelTexts(guessInput.value);
        }
        function setResultSquaresToYYYYY() {
             const squares = resultSquaresContainer.children;
             for (let i = 0; i < currentWordLength; i++) { if (squares[i]) { squares[i].className = 'result-square green'; squares[i].dataset.color = 'green'; } }
        }
        function updateSuggestionsList() {
            suggestionsList.innerHTML = ''; let suggestionsToShow = [];
            if (isFirstGuess) {
                suggestionsToShow = bestStarters;
                if (suggestionsToShow.length > 0) { const titleLi = document.createElement('li'); titleLi.textContent = "--- Başlangıç Önerileri ---"; titleLi.style.fontWeight = 'bold'; titleLi.style.backgroundColor = '#f0f0f0'; suggestionsList.appendChild(titleLi); }
            } else { suggestionsToShow = possibleWords.slice(0, SUGGESTION_COUNT); }
            if (suggestionsToShow.length === 0 && possibleWords.length > 0 && !isFirstGuess) { suggestionsToShow = possibleWords.slice(0, possibleWords.length); }
            if (possibleWords.length === 0 && !isFirstGuess) { const li = document.createElement('li'); li.textContent = "(Olası kelime kalmadı)"; suggestionsList.appendChild(li); }
            else if (suggestionsToShow.length === 0 && isFirstGuess) { const li = document.createElement('li'); li.textContent = "(Başlangıç önerisi hesaplanamadı veya kelime listesi boş)"; suggestionsList.appendChild(li); }
            else {
                suggestionsToShow.forEach(word => { const li = document.createElement('li'); li.textContent = word.toUpperCase(); li.addEventListener('click', () => { guessInput.value = word.toUpperCase(); updateResultLabelTexts(word); }); suggestionsList.appendChild(li); });
                if (isFirstGuess && possibleWords.length > suggestionsToShow.length) {
                     const separatorLi = document.createElement('li'); separatorLi.textContent = `--- Diğer Olasılıklar (${possibleWords.length}) ---`; separatorLi.style.fontWeight = 'bold'; separatorLi.style.backgroundColor = '#f0f0f0'; suggestionsList.appendChild(separatorLi);
                     const otherSuggestions = possibleWords.filter(w => !suggestionsToShow.includes(w)).slice(0, 10);
                     otherSuggestions.forEach(word => { const li = document.createElement('li'); li.textContent = word.toUpperCase(); li.addEventListener('click', () => { guessInput.value = word.toUpperCase(); updateResultLabelTexts(word); }); suggestionsList.appendChild(li); });
                } else if (!isFirstGuess && possibleWords.length > suggestionsToShow.length) { const li = document.createElement('li'); li.textContent = `... ve ${possibleWords.length - suggestionsToShow.length} tane daha`; suggestionsList.appendChild(li); }
            }
        }
        function updateStatusMessage() {
            let count = possibleWords.length; let msg = `Kalan olası kelime: ${count}`;
            if (isFirstGuess) { msg += " | İyi başlangıçlar öneriliyor."; }
            else if (count === 0) { msg = "Eşleşen kelime bulunamadı!"; }
            else if (count === 1 && !isFirstGuess) { if (filterBtn.disabled) { msg = `Kelime bulundu: ${possibleWords[0].toUpperCase()}`; } else { msg = `Sonraki tahmin: ${possibleWords[0].toUpperCase()}`; } }
            statusMessage.textContent = msg;
        }

        function setupNewGame(length) {
            currentWordLength = length; solverTitle.textContent = `${length} Harfli Çözücü`;
            guessInput.maxLength = length; guessInput.value = ''; filterBtn.disabled = false;
            allWordsCurrentLength = masterWordList.filter(word => word.length === length);
            if (allWordsCurrentLength.length === 0) {
                statusMessage.textContent = `Bu uzunlukta (${length}) kelime bulunamadı. Lütfen kelime listenizi kontrol edin veya farklı bir uzunluk seçin.`;
                console.log(`setupNewGame: ${length} uzunluğunda kelime bulunamadı.`);
                possibleWords = []; bestStarters = [];
                if (resultSquaresContainer) resultSquaresContainer.innerHTML = '';
                if (suggestionsList) updateSuggestionsList();
                return false;
            }
            possibleWords = [...allWordsCurrentLength]; isFirstGuess = true;
            const topLettersSet = TOP_LETTERS_BY_LENGTH[length] || new Set();
            bestStarters = findBestStartingWords(allWordsCurrentLength, topLettersSet, SUGGESTION_COUNT, length);
            console.log(`${length} harfli en iyi başlangıç önerileri (Frekansa Göre):`, bestStarters);
            createResultSquares(length); updateSuggestionsList(); updateStatusMessage();
            return true;
        }
        function handleFilter() {
            const guess = guessInput.value.toUpperCase(); const resultColors = [];
            const squares = resultSquaresContainer.children;
            for (let i = 0; i < currentWordLength; i++) { resultColors.push(squares[i].dataset.color || 'gray'); }
            const resultString = resultColors.map(color => colorMapToChar[color]).join('');
            const validation = validateInput(guess, resultString, currentWordLength);
            if (!validation.isValid) { alert("Geçersiz Girdi: " + validation.message); guessInput.focus(); return; }
            if (resultString === 'Y'.repeat(currentWordLength)) {
                alert(`Tebrikler! Kelimeyi buldunuz: ${guess}`); possibleWords = [turkishLower(guess)]; isFirstGuess = false;
                updateStatusMessage(); updateSuggestionsList(); filterBtn.disabled = true; return;
            }
            const initialCount = possibleWords.length;
            possibleWords = filterWords(possibleWords, guess, resultColors, currentWordLength);
            isFirstGuess = false; updateStatusMessage(); updateSuggestionsList(); resetResultSquares();
            guessInput.focus(); guessInput.select();
            if (possibleWords.length === 0) { alert("Girdiğiniz bilgilere uyan olası kelime kalmadı..."); filterBtn.disabled = true; }
            else if (possibleWords.length === 1 && initialCount > 1) {
                const foundWord = possibleWords[0].toUpperCase(); alert(`Kalan tek olasılık: ${foundWord}`);
                guessInput.value = foundWord; updateResultLabelTexts(foundWord); setResultSquaresToYYYYY(); filterBtn.disabled = true;
            }
        }
        function handleResetGame() {
            if (allWordsCurrentLength.length === 0) { alert("Sıfırlanacak aktif oyun yok..."); return; }
            guessInput.value = ''; possibleWords = [...allWordsCurrentLength]; isFirstGuess = true;
            resetResultSquares(); updateSuggestionsList(); updateStatusMessage();
            filterBtn.disabled = false; guessInput.focus();
            console.log(`${currentWordLength} harfli oyun sıfırlandı.`);
        }
        function handleNewGameSelection() {
            solverScreen.style.display = 'none'; initialScreen.style.display = 'flex';
            guessInput.value = '';
            if(resultSquaresContainer) resultSquaresContainer.innerHTML = '';
            if(suggestionsList) suggestionsList.innerHTML = '';
            statusMessage.textContent = '1. Kelime listesini yükleyin, 2. Uzunluk seçin, 3. Oyuna başlayın.';
            allWordsCurrentLength = []; possibleWords = []; isFirstGuess = true;
            wordlistFileEl.value = "";
        }

        startGameBtn.addEventListener('click', () => {
            if (masterWordList.length === 0) {
                alert("Lütfen önce bir kelime listesi dosyası seçin ve yüklenmesinin tamamlanmasını bekleyin.");
                wordlistFileEl.focus(); return;
            }
            const selectedRadio = document.querySelector('input[name="wordLength"]:checked');
            if (selectedRadio) {
                const length = parseInt(selectedRadio.value);
                if (setupNewGame(length)) {
                    initialScreen.style.display = 'none';
                    solverScreen.style.display = 'flex';
                }
            } else { alert("Lütfen bir kelime uzunluğu seçin."); }
        });

        wordlistFileEl.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (file) {
                statusMessage.textContent = "Kelime listesi yükleniyor...";
                try {
                    masterWordList = await loadWordsFromFile(file);
                    statusMessage.textContent = `${masterWordList.length} kelime yüklendi. Şimdi uzunluk seçip başlayabilirsiniz.`;
                    console.log("Master word list loaded from file:", masterWordList.length);
                } catch (error) {
                    alert("Kelime listesi yüklenirken hata: " + error.message);
                    statusMessage.textContent = "Kelime listesi yüklenemedi. Lütfen geçerli bir .txt dosyası seçin.";
                    masterWordList = [];
                }
            }
        });

        guessInput.addEventListener('input', (event) => {
            let value = event.target.value.toUpperCase(); value = value.replace(/[^A-ZÇĞIİÖŞÜ]/g, '');
            event.target.value = value; updateResultLabelTexts(value);
        });
        guessInput.addEventListener('keypress', (event) => { if (event.key === 'Enter') { handleFilter(); } });

        filterBtn.addEventListener('click', handleFilter);
        resetBtn.addEventListener('click', handleResetGame);
        newGameBtn.addEventListener('click', handleNewGameSelection);

        solverScreen.style.display = 'none'; initialScreen.style.display = 'flex';
        statusMessage.textContent = "1. Kelime listesini yükleyin (.txt), 2. Uzunluk seçin, 3. Oyuna başlayın.";

    </script>
</body>
</html>